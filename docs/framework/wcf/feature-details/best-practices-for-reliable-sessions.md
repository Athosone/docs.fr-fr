---
title: Meilleures pratiques pour les sessions fiables
ms.date: 03/30/2017
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
ms.openlocfilehash: 1d9671e7e3124d535b66de8cd8468f76dcb32b10
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61857985"
---
# <a name="best-practices-for-reliable-sessions"></a><span data-ttu-id="1776a-102">Meilleures pratiques pour les sessions fiables</span><span class="sxs-lookup"><span data-stu-id="1776a-102">Best Practices for Reliable Sessions</span></span>

<span data-ttu-id="1776a-103">Cette rubrique traite des meilleures pratiques pour les sessions fiables.</span><span class="sxs-lookup"><span data-stu-id="1776a-103">This topic discusses best practices for reliable sessions.</span></span>

## <a name="setting-maxtransferwindowsize"></a><span data-ttu-id="1776a-104">Définition de MaxTransferWindowSize</span><span class="sxs-lookup"><span data-stu-id="1776a-104">Setting MaxTransferWindowSize</span></span>

<span data-ttu-id="1776a-105">Sessions fiables dans Windows Communication Foundation (WCF) utilisent une fenêtre de transfert pour contenir les messages sur le client et le service.</span><span class="sxs-lookup"><span data-stu-id="1776a-105">Reliable sessions in Windows Communication Foundation (WCF) use a transfer window to hold messages on the client and service.</span></span> <span data-ttu-id="1776a-106">La propriété configurable <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indique combien de messages la fenêtre de transfert peut contenir.</span><span class="sxs-lookup"><span data-stu-id="1776a-106">The configurable property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages the transfer window can hold.</span></span>

<span data-ttu-id="1776a-107">Sur l’expéditeur, cela indique combien de messages la fenêtre de transfert peut contenir en attendant des accusés de réception ; sur le récepteur, il indique le nombre de messages dans la mémoire tampon pour le service.</span><span class="sxs-lookup"><span data-stu-id="1776a-107">On the sender, this indicates how many messages the transfer window can hold while waiting for acknowledgements; on the receiver, it indicates how many messages to buffer for the service.</span></span>

<span data-ttu-id="1776a-108">Choix de la taille a un impact sur l’efficacité du réseau et la capacité optimale du service.</span><span class="sxs-lookup"><span data-stu-id="1776a-108">Choosing the right size impacts the efficiency of the network and the optimal capacity of the service.</span></span> <span data-ttu-id="1776a-109">Les sections suivantes détaillent les éléments à prendre en compte lors du choix d’une valeur pour cette propriété et l’impact de la valeur.</span><span class="sxs-lookup"><span data-stu-id="1776a-109">The following sections detail what to consider when choosing a value for this property and the impact of the value.</span></span>

<span data-ttu-id="1776a-110">La taille de fenêtre de transfert par défaut est 8 messages.</span><span class="sxs-lookup"><span data-stu-id="1776a-110">The default transfer window size is eight messages.</span></span>

### <a name="efficient-use-of-the-network"></a><span data-ttu-id="1776a-111">Utilisation efficace du réseau</span><span class="sxs-lookup"><span data-stu-id="1776a-111">Efficient use of the network</span></span>

<span data-ttu-id="1776a-112">Dans ce contexte, le terme *réseau* correspond à tous les éléments utilisés comme base de communication entre un client (expéditeur) et un service (récepteur).</span><span class="sxs-lookup"><span data-stu-id="1776a-112">In this context, the term *network* corresponds to everything used as the basis of communication between a client (sender) and a service (receiver).</span></span> <span data-ttu-id="1776a-113">Cela inclut les connexions de transport et de tout intermédiaire ou de ponts entre eux, y compris les routeurs SOAP ou proxys/pare-feu HTTP.</span><span class="sxs-lookup"><span data-stu-id="1776a-113">This includes the transport connections and any intermediary or bridges in between, including SOAP routers or HTTP proxies/firewalls.</span></span>

<span data-ttu-id="1776a-114">L'utilisation efficace du réseau garantit que sa capacité est pleinement utilisée.</span><span class="sxs-lookup"><span data-stu-id="1776a-114">Efficient use of the network ensures that network capacity is fully used.</span></span> <span data-ttu-id="1776a-115">La quantité de données qui peuvent être transférées par seconde sur le réseau (*débit*) et le temps nécessaire pour transférer des données à partir de l’expéditeur au destinataire (*latence*) avoir un impact sur l’efficacité avec laquelle le réseau est utilisé.</span><span class="sxs-lookup"><span data-stu-id="1776a-115">Both the amount of data that can be transferred per second over the network (*data rate*) and the time it takes to transfer data from the sender to the receiver (*latency*) impact how effectively the network is utilized.</span></span>

<span data-ttu-id="1776a-116">Sur l'expéditeur, la propriété <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indique combien de messages sa fenêtre de transfert peut contenir en attendant des accusés de réception.</span><span class="sxs-lookup"><span data-stu-id="1776a-116">On the sender, the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages its transfer window can hold while waiting for acknowledgements.</span></span> <span data-ttu-id="1776a-117">Si la latence du réseau est élevée, et afin de garantir un expéditeur réactif et l’utilisation efficace du réseau, vous devez augmenter la taille de fenêtre de transfert.</span><span class="sxs-lookup"><span data-stu-id="1776a-117">If the network latency is high and in order to ensure a responsive sender and effective network utilization, you should increase the transfer window size.</span></span>

<span data-ttu-id="1776a-118">Par exemple même si l’expéditeur s’adapte à un débit de données, la latence peut être élevée si plusieurs intermédiaires existent entre l’expéditeur et le destinataire ou les données doivent transiter par un intermédiaire avec perte de données ou un réseau.</span><span class="sxs-lookup"><span data-stu-id="1776a-118">For example even if the sender keeps up with data rate, latency could be high if several intermediaries exist between the sender and receiver or the data must pass through a lossy intermediary or network.</span></span> <span data-ttu-id="1776a-119">Par conséquent, l’expéditeur doit attendre les accusés de réception pour les messages dans sa fenêtre de transfert avant d’accepter de nouveaux messages à envoyer sur le câble.</span><span class="sxs-lookup"><span data-stu-id="1776a-119">Thus, the sender has to wait for acknowledgements for the messages in its transfer window before accepting new messages to send on the wire.</span></span> <span data-ttu-id="1776a-120">Plus la mémoire tampon avec une latence élevée, moins l’effet l’utilisation du réseau.</span><span class="sxs-lookup"><span data-stu-id="1776a-120">The smaller the buffer with high latency, the less effective the network utilization.</span></span> <span data-ttu-id="1776a-121">Quant à eux, trop élevée une taille de fenêtre de transfert peut avoir un impact sur le service, car le service peut avoir besoin de rattraper le taux élevé de données envoyées par le client.</span><span class="sxs-lookup"><span data-stu-id="1776a-121">On the other hand, too high a transfer window size may impact the service because the service may need to catch up to the high rate of data sent by the client.</span></span>

### <a name="running-the-service-to-capacity"></a><span data-ttu-id="1776a-122">Le service en cours d’exécution à la capacité</span><span class="sxs-lookup"><span data-stu-id="1776a-122">Running the service to capacity</span></span>

<span data-ttu-id="1776a-123">Autant que le réseau est utilisé efficacement, dans l’idéal, vous souhaitez également le service s’exécute à capacité optimale.</span><span class="sxs-lookup"><span data-stu-id="1776a-123">As much as the network is used efficiently, ideally you also want the service to run at optimal capacity.</span></span> <span data-ttu-id="1776a-124">La propriété de la taille de la fenêtre de transfert sur le récepteur indique combien de messages le récepteur peut mettre en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="1776a-124">The transfer window size property on the receiver indicates how many messages the receiver can buffer.</span></span> <span data-ttu-id="1776a-125">Cette mise en mémoire tampon permet non seulement de contrôler le flux du réseau mais également d'exécuter le service à capacité complète.</span><span class="sxs-lookup"><span data-stu-id="1776a-125">This message buffering helps not only the network flow control but also enables the service to run to full capacity.</span></span> <span data-ttu-id="1776a-126">Par exemple, si la mémoire tampon est un message et les messages arrivent plus rapidement que le service peut les traiter, puis le réseau peut supprimer des messages et de capacité peut-être être gaspillée ou sous-utilisée.</span><span class="sxs-lookup"><span data-stu-id="1776a-126">For example if the buffer is one message and messages arrive faster than the service can process them, then the network might drop messages and capacity might be wasted or underutilized.</span></span>

<span data-ttu-id="1776a-127">À l’aide d’une mémoire tampon d’augmente la disponibilité du service reçoit et met en mémoire tampon un message lors du traitement des messages précédemment reçus simultanément.</span><span class="sxs-lookup"><span data-stu-id="1776a-127">Using a buffer increases the availability of the service as it concurrently receives and buffers a message while processing the previously received messages.</span></span>

<span data-ttu-id="1776a-128">Nous recommandons d’utiliser le même `MaxTransferWindowSize` sur l’expéditeur et du récepteur.</span><span class="sxs-lookup"><span data-stu-id="1776a-128">We recommended that you use the same `MaxTransferWindowSize` on both the sender and receiver.</span></span>

### <a name="enabling-flow-control"></a><span data-ttu-id="1776a-129">L’activation du contrôle de flux</span><span class="sxs-lookup"><span data-stu-id="1776a-129">Enabling flow control</span></span>

<span data-ttu-id="1776a-130">*Contrôle de flux* est un mécanisme qui permet de s’assurer que l’expéditeur et le destinataire s’adapter à l’autre, autrement dit, les messages sont consommés et traités aussi rapidement qu’ils sont générés.</span><span class="sxs-lookup"><span data-stu-id="1776a-130">*Flow control* is a mechanism that ensures that the sender and receiver keep pace with each other, that is, the messages are consumed and acted upon as fast as they're produced.</span></span> <span data-ttu-id="1776a-131">La taille de la fenêtre de transfert sur le client et sur le service garantit que l’expéditeur et le récepteur respectent une fenêtre de synchronisation raisonnable.</span><span class="sxs-lookup"><span data-stu-id="1776a-131">The transfer window size on the client and service ensures that the sender and receiver are within a reasonable window of synchronization.</span></span>

<span data-ttu-id="1776a-132">Il est vivement recommandé que vous définissez la propriété <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> à `true` lorsque vous utilisez une session fiable entre un client WCF et un service WCF.</span><span class="sxs-lookup"><span data-stu-id="1776a-132">We highly recommended that you set the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> to `true` when you're using a reliable session between a WCF client and a WCF service.</span></span>

## <a name="setting-maxpendingchannels"></a><span data-ttu-id="1776a-133">Définition de MaxPendingChannels</span><span class="sxs-lookup"><span data-stu-id="1776a-133">Setting MaxPendingChannels</span></span>

<span data-ttu-id="1776a-134">Lorsque vous écrivez un service qui permet la communication de session fiable à partir de différents clients, il est possible que plusieurs clients à établir une session fiable pour le service en même temps.</span><span class="sxs-lookup"><span data-stu-id="1776a-134">When writing a service that enables reliable session communication from different clients, it's possible to have many clients establish a reliable session to the service at the same time.</span></span> <span data-ttu-id="1776a-135">La réponse du service dans ces situations dépend de la propriété `MaxPendingChannels`.</span><span class="sxs-lookup"><span data-stu-id="1776a-135">The response of the service in these situations depends on the `MaxPendingChannels` property.</span></span>

<span data-ttu-id="1776a-136">Lorsque l'expéditeur crée un canal de session fiable vers un récepteur, une négociation entre eux établit une session fiable.</span><span class="sxs-lookup"><span data-stu-id="1776a-136">When the sender creates a reliable session channel to a receiver, a handshake between them establishes a reliable session.</span></span> <span data-ttu-id="1776a-137">Après avoir établi la session fiable, le canal est mis en file d'attente pour l'acceptation par le service.</span><span class="sxs-lookup"><span data-stu-id="1776a-137">After the reliable session is established, the channel is put in a pending channel queue for acceptance by the service.</span></span> <span data-ttu-id="1776a-138">La propriété `MaxPendingChannels` indique combien de canaux peuvent être dans cet état.</span><span class="sxs-lookup"><span data-stu-id="1776a-138">The `MaxPendingChannels` property indicates how many channels can be in this state.</span></span>

<span data-ttu-id="1776a-139">Il est possible pour le service doit être dans un état où il ne peut pas accepter plus de canaux.</span><span class="sxs-lookup"><span data-stu-id="1776a-139">It's possible for the service to be in a state where it can't accept more channels.</span></span> <span data-ttu-id="1776a-140">Si la file d’attente est pleine, tenter d’établir une session fiable est rejetée et le client doit réessayer.</span><span class="sxs-lookup"><span data-stu-id="1776a-140">If the queue is full, an attempt to establish a reliable session is rejected, and the client must retry.</span></span>

<span data-ttu-id="1776a-141">Il est également possible que les canaux en attente dans la file d’attente restent dans la file d’attente pour une durée plus longue.</span><span class="sxs-lookup"><span data-stu-id="1776a-141">It's also possible that the pending channels in the queue remain in the queue for a longer duration.</span></span> <span data-ttu-id="1776a-142">En attendant, un délai d’inactivité sur la session fiable peut se produire, provoquant le canal à passer à un état d’erreur.</span><span class="sxs-lookup"><span data-stu-id="1776a-142">In the meantime, an inactivity timeout on the reliable session may occur, causing the channel to transition to a faulted state.</span></span>

<span data-ttu-id="1776a-143">Lorsque vous écrivez un service servant plusieurs clients simultanément, vous devez définir une valeur qui est adaptée à vos besoins.</span><span class="sxs-lookup"><span data-stu-id="1776a-143">When writing a service that services multiple clients simultaneously, you should set a value that's suitable for your needs.</span></span> <span data-ttu-id="1776a-144">Définition d’une valeur trop élevée pour le `MaxPendingChannels` propriété a un impact sur votre jeu de travail.</span><span class="sxs-lookup"><span data-stu-id="1776a-144">Setting too high a value for the `MaxPendingChannels` property impacts your working set.</span></span>

<span data-ttu-id="1776a-145">La valeur par défaut <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> est quatre canaux.</span><span class="sxs-lookup"><span data-stu-id="1776a-145">The default value for <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> is four channels.</span></span>

## <a name="reliable-sessions-and-hosting"></a><span data-ttu-id="1776a-146">Les sessions fiables et hébergement</span><span class="sxs-lookup"><span data-stu-id="1776a-146">Reliable sessions and hosting</span></span>

<span data-ttu-id="1776a-147">Lorsque web qui héberge un service qui utilise des sessions fiables, vous gardez les points importants suivants à l’esprit :</span><span class="sxs-lookup"><span data-stu-id="1776a-147">When web hosting a service that uses reliable sessions, you should keep the following important considerations in mind:</span></span>

- <span data-ttu-id="1776a-148">Les sessions fiables sont avec état, et l'état est géré dans AppDomain.</span><span class="sxs-lookup"><span data-stu-id="1776a-148">Reliable sessions are stateful, and state is maintained in the AppDomain.</span></span> <span data-ttu-id="1776a-149">Cela signifie que tous les messages qui font partie d'une session fiable doivent être traités dans le même AppDomain.</span><span class="sxs-lookup"><span data-stu-id="1776a-149">This means that all messages that are part of a reliable session must be processed in the same AppDomain.</span></span> <span data-ttu-id="1776a-150">Batteries de serveurs Web et les domaines privés web où la taille de la batterie de serveurs ou d’un domaine privé est supérieure à un seul nœud ne peut pas garantir cette contrainte.</span><span class="sxs-lookup"><span data-stu-id="1776a-150">Web farms and web gardens where the size of the farm or garden is greater than one node can't guarantee this constraint.</span></span>

- <span data-ttu-id="1776a-151">Les sessions fiables à l’aide de canaux HTTP doubles (par exemple, à l’aide de `WsDualHttpBinding`) peuvent nécessiter plus que la valeur par défaut de deux connexions par-client HTTP.</span><span class="sxs-lookup"><span data-stu-id="1776a-151">Reliable sessions using dual HTTP channels (for example, using `WsDualHttpBinding`) can require more than the default of two HTTP connections per-client.</span></span> <span data-ttu-id="1776a-152">Cela signifie qu'une session fiable duplex peut nécessiter jusqu'à deux connexions dans chaque direction, car les messages d’application et de protocole simultanés peuvent être transférés dans chaque direction à tout moment donné.</span><span class="sxs-lookup"><span data-stu-id="1776a-152">This means a duplex reliable session can require up to two connections each way because concurrent application and protocol messages may be transferring each way at any given time.</span></span> <span data-ttu-id="1776a-153">Sous certaines conditions selon le modèle d’échange de messages du service, cela signifie qu’il est possible d’interbloquer un service hébergé sur le web à l’aide de HTTP double et sessions fiables.</span><span class="sxs-lookup"><span data-stu-id="1776a-153">Under certain conditions depending on the message exchange pattern of the service, this means that it's possible to deadlock a web-hosted service using dual HTTP and reliable sessions.</span></span> <span data-ttu-id="1776a-154">Pour augmenter le nombre de connexions HTTP autorisées par client, ajoutez le code suivant au fichier de configuration approprié (par exemple, *web.config* du service en question) :</span><span class="sxs-lookup"><span data-stu-id="1776a-154">To increase the number of allowable HTTP connections per client, add the following to the relevant configuration file (for example, *web.config* of the service in question):</span></span>

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  <span data-ttu-id="1776a-155">La valeur de la `maxconnection` attribut est le nombre de connexions nécessaires.</span><span class="sxs-lookup"><span data-stu-id="1776a-155">The value of the `maxconnection` attribute is the number of connections needed.</span></span> <span data-ttu-id="1776a-156">La valeur minimale dans ce cas doit être quatre connexions.</span><span class="sxs-lookup"><span data-stu-id="1776a-156">The minimum in this case should be four connections.</span></span>
