---
title: UI Automation d'un contrôle personnalisé WPF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- custom controls [WPF], applying UI automation
- accessibility [WPF], applying to custom controls
- custom controls [WPF], improving accessibility
- UI Automation [WPF], using with custom controls
ms.assetid: 47b310fc-fbd5-4ce2-a606-22d04c6d4911
ms.openlocfilehash: 0d663acc195b36fdc95c196f2233ae997fbd9195
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/18/2019
ms.locfileid: "59132767"
---
# <a name="ui-automation-of-a-wpf-custom-control"></a><span data-ttu-id="20bcf-102">UI Automation d'un contrôle personnalisé WPF</span><span class="sxs-lookup"><span data-stu-id="20bcf-102">UI Automation of a WPF Custom Control</span></span>
[!INCLUDE[TLA#tla_uiautomation](../../../../includes/tlasharptla-uiautomation-md.md)] <span data-ttu-id="20bcf-103">fournit une interface unique et généralisée que les clients Automation peuvent utiliser pour examiner ou utiliser les interfaces utilisateur de diverses plateformes et infrastructures.</span><span class="sxs-lookup"><span data-stu-id="20bcf-103">provides a single, generalized interface that automation clients can use to examine or operate the user interfaces of a variety of platforms and frameworks.</span></span> [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] <span data-ttu-id="20bcf-104">active à la fois le code d’assurance qualité (test) et les applications d’accessibilité, par exemple les lecteurs d’écran, pour examiner les éléments de l’interface utilisateur et simuler la manière dont les utilisateurs interagissent avec ces éléments à partir d’un autre code.</span><span class="sxs-lookup"><span data-stu-id="20bcf-104">enables both quality-assurance (test) code and accessibility applications such as screen readers to examine user-interface elements and simulate user interaction with them from other code.</span></span> <span data-ttu-id="20bcf-105">Pour plus d’informations sur [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] pour toutes les plateformes, consultez la rubrique d’accessibilité.</span><span class="sxs-lookup"><span data-stu-id="20bcf-105">For information about [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] across all platforms, see Accessibility.</span></span>  
  
 <span data-ttu-id="20bcf-106">Cette rubrique explique comment implémenter un fournisseur UI Automation côté serveur pour un contrôle personnalisé qui s’exécute dans une application WPF.</span><span class="sxs-lookup"><span data-stu-id="20bcf-106">This topic describes how to implement a server-side UI Automation provider for a custom control that runs in a WPF application.</span></span> <span data-ttu-id="20bcf-107">WPF prend en charge [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] à travers une arborescence d’objets Automation homologues qui présente en parallèle l’arborescence des éléments de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="20bcf-107">WPF supports [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] through a tree of peer automation objects that parallels the tree of user interface elements.</span></span> <span data-ttu-id="20bcf-108">Le code de test et les applications qui fournissent des fonctionnalités d’accessibilité peuvent utiliser des objets homologues Automation, soit directement (pour le code in-process), soit travers l’interface généralisée fournie par [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)].</span><span class="sxs-lookup"><span data-stu-id="20bcf-108">Test code and applications that provide accessibility features can use automation peer objects directly (for in-process code) or through the generalized interface provided by [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)].</span></span>  

<a name="AutomationPeerClasses"></a>   
## <a name="automation-peer-classes"></a><span data-ttu-id="20bcf-109">Classes homologues Automation</span><span class="sxs-lookup"><span data-stu-id="20bcf-109">Automation Peer Classes</span></span>  
 <span data-ttu-id="20bcf-110">Prise en charge des contrôles WPF [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] à travers une arborescence de classes homologues qui dérivent de <xref:System.Windows.Automation.Peers.AutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-110">WPF controls support [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] through a tree of peer classes that derive from <xref:System.Windows.Automation.Peers.AutomationPeer>.</span></span> <span data-ttu-id="20bcf-111">Par convention, les noms de classes homologues commencent par le nom de la classe de contrôle et se terminent par « AutomationPeer ».</span><span class="sxs-lookup"><span data-stu-id="20bcf-111">By convention, peer class names begin with the control class name and end with "AutomationPeer".</span></span> <span data-ttu-id="20bcf-112">Par exemple, <xref:System.Windows.Automation.Peers.ButtonAutomationPeer> est la classe homologue pour la <xref:System.Windows.Controls.Button> classe de contrôle.</span><span class="sxs-lookup"><span data-stu-id="20bcf-112">For example, <xref:System.Windows.Automation.Peers.ButtonAutomationPeer> is the peer class for the <xref:System.Windows.Controls.Button> control class.</span></span> <span data-ttu-id="20bcf-113">Les classes homologues sont à peu près équivalentes aux types de contrôle [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)], mais sont spécifiques aux éléments [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span><span class="sxs-lookup"><span data-stu-id="20bcf-113">The peer classes are roughly equivalent to [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] control types but are specific to [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] elements.</span></span> <span data-ttu-id="20bcf-114">Le code Automation qui accède aux applications WPF via l’interface [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] n’utilise pas directement les homologues Automation, mais le code Automation dans le même espace de processus peut utiliser directement les homologues Automation.</span><span class="sxs-lookup"><span data-stu-id="20bcf-114">Automation code that accesses WPF applications through the [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] interface does not use automation peers directly, but automation code in the same process space can use automation peers directly.</span></span>  
  
<a name="BuiltInAutomationPeerClasses"></a>   
## <a name="built-in-automation-peer-classes"></a><span data-ttu-id="20bcf-115">Classes homologues Automation intégrées</span><span class="sxs-lookup"><span data-stu-id="20bcf-115">Built-in Automation Peer Classes</span></span>  
 <span data-ttu-id="20bcf-116">Des éléments implémentent une classe homologue Automation s’ils acceptent l’activité de l’utilisateur dans l’interface, ou s’ils contiennent les informations dont ont besoin les utilisateurs d’applications de lecteur d’écran.</span><span class="sxs-lookup"><span data-stu-id="20bcf-116">Elements implement an automation peer class if they accept interface activity from the user, or if they contain information needed by users of screen-reader applications.</span></span> <span data-ttu-id="20bcf-117">Tous les éléments visuels WPF n’ont pas d’homologues Automation.</span><span class="sxs-lookup"><span data-stu-id="20bcf-117">Not all WPF visual elements have automation peers.</span></span> <span data-ttu-id="20bcf-118">Exemples de classes qui implémentent des homologues automation sont <xref:System.Windows.Controls.Button>, <xref:System.Windows.Controls.TextBox>, et <xref:System.Windows.Controls.Label>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-118">Examples of classes that implement automation peers are <xref:System.Windows.Controls.Button>, <xref:System.Windows.Controls.TextBox>, and <xref:System.Windows.Controls.Label>.</span></span> <span data-ttu-id="20bcf-119">Exemples de classes qui n’implémentent pas d’homologues automation sont des classes qui dérivent de <xref:System.Windows.Controls.Decorator>, tel que <xref:System.Windows.Controls.Border>et des classes basées sur <xref:System.Windows.Controls.Panel>, tel que <xref:System.Windows.Controls.Grid> et <xref:System.Windows.Controls.Canvas>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-119">Examples of classes that do not implement automation peers are classes that derive from <xref:System.Windows.Controls.Decorator>, such as <xref:System.Windows.Controls.Border>, and classes based on <xref:System.Windows.Controls.Panel>, such as <xref:System.Windows.Controls.Grid> and <xref:System.Windows.Controls.Canvas>.</span></span>  
  
 <span data-ttu-id="20bcf-120">La base de <xref:System.Windows.Controls.Control> classe n’a pas de classe homologue correspondante.</span><span class="sxs-lookup"><span data-stu-id="20bcf-120">The base <xref:System.Windows.Controls.Control> class does not have a corresponding peer class.</span></span> <span data-ttu-id="20bcf-121">Si vous avez besoin d’une classe homologue corresponde à un contrôle personnalisé qui dérive de <xref:System.Windows.Controls.Control>, vous devez dériver la classe homologue personnalisée à partir de <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-121">If you need a peer class to correspond to a custom control that derives from <xref:System.Windows.Controls.Control>, you should derive the custom peer class from <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>.</span></span>  
  
<a name="SecurityConsiderations"></a>   
## <a name="security-considerations-for-derived-peers"></a><span data-ttu-id="20bcf-122">Considérations relatives à la sécurité des homologues dérivés</span><span class="sxs-lookup"><span data-stu-id="20bcf-122">Security Considerations for Derived Peers</span></span>  
 <span data-ttu-id="20bcf-123">Les homologues Automation doivent s’exécuter dans un environnement de confiance partielle.</span><span class="sxs-lookup"><span data-stu-id="20bcf-123">Automation peers must run in a partial-trust environment.</span></span> <span data-ttu-id="20bcf-124">Le code dans l’assembly UIAutomationClient n’est pas configuré pour s’exécuter dans un environnement de confiance partielle et le code homologue Automation ne doit pas référencer cet assembly.</span><span class="sxs-lookup"><span data-stu-id="20bcf-124">Code in the UIAutomationClient assembly is not configured to run in a partial-trust environment, and automation peer code should not reference that assembly.</span></span> <span data-ttu-id="20bcf-125">Au lieu de cela, vous devez utiliser les classes de l’assembly UIAutomationTypes.</span><span class="sxs-lookup"><span data-stu-id="20bcf-125">Instead, you should use the classes in the UIAutomationTypes assembly.</span></span> <span data-ttu-id="20bcf-126">Par exemple, vous devez utiliser le <xref:System.Windows.Automation.AutomationElementIdentifiers> classe à partir de l’assembly UIAutomationTypes, qui correspond à la <xref:System.Windows.Automation.AutomationElement> classe dans l’assembly UIAutomationClient.</span><span class="sxs-lookup"><span data-stu-id="20bcf-126">For example, you should use the <xref:System.Windows.Automation.AutomationElementIdentifiers> class from the UIAutomationTypes assembly, which corresponds to the <xref:System.Windows.Automation.AutomationElement> class in the UIAutomationClient assembly.</span></span> <span data-ttu-id="20bcf-127">La démarche la plus sûre consiste à référencer l’assembly UIAutomationTypes dans le code homologue Automation.</span><span class="sxs-lookup"><span data-stu-id="20bcf-127">It is safe to reference the UIAutomationTypes assembly in automation peer code.</span></span>  
  
<a name="PeerNavigation"></a>   
## <a name="peer-navigation"></a><span data-ttu-id="20bcf-128">Navigation homologue</span><span class="sxs-lookup"><span data-stu-id="20bcf-128">Peer Navigation</span></span>  
 <span data-ttu-id="20bcf-129">Après avoir localisé un homologue automation, code in-process peut naviguer l’arborescence homologue en appelant l’objet <xref:System.Windows.Automation.Peers.AutomationPeer.GetChildren%2A> et <xref:System.Windows.Automation.Peers.AutomationPeer.GetParent%2A> méthodes.</span><span class="sxs-lookup"><span data-stu-id="20bcf-129">After locating an automation peer, in-process code can navigate the peer tree by calling the object's <xref:System.Windows.Automation.Peers.AutomationPeer.GetChildren%2A> and <xref:System.Windows.Automation.Peers.AutomationPeer.GetParent%2A> methods.</span></span> <span data-ttu-id="20bcf-130">Navigation parmi les [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] éléments au sein d’un contrôle est pris en charge par l’implémentation de l’homologue de la <xref:System.Windows.Automation.Peers.AutomationPeer.GetChildrenCore%2A> (méthode).</span><span class="sxs-lookup"><span data-stu-id="20bcf-130">Navigation among [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] elements within a control is supported by the peer's implementation of the <xref:System.Windows.Automation.Peers.AutomationPeer.GetChildrenCore%2A> method.</span></span> <span data-ttu-id="20bcf-131">Le système UI Automation appelle cette méthode pour générer une arborescence de sous-éléments contenus dans un contrôle ; par exemple, des éléments de liste dans une zone de liste.</span><span class="sxs-lookup"><span data-stu-id="20bcf-131">The UI Automation system calls this method to build up a tree of subelements contained within a control; for example, list items in a list box.</span></span> <span data-ttu-id="20bcf-132">La valeur par défaut <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A?displayProperty=nameWithType> méthode parcourt l’arborescence visuelle d’éléments pour générer l’arborescence des homologues automation.</span><span class="sxs-lookup"><span data-stu-id="20bcf-132">The default <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A?displayProperty=nameWithType> method traverses the visual tree of elements to build the tree of automation peers.</span></span> <span data-ttu-id="20bcf-133">Les contrôles personnalisés contournent cette méthode pour exposer les éléments enfants aux clients Automation, en retournant les homologues Automation des éléments qui acheminent des informations ou qui permettent une interaction avec l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="20bcf-133">Custom controls override this method to expose children elements to automation clients, returning the automation peers of elements that convey information or allow user interaction.</span></span>  
  
<a name="Customizations"></a>   
## <a name="customizations-in-a-derived-peer"></a><span data-ttu-id="20bcf-134">Personnalisations dans un homologue dérivé</span><span class="sxs-lookup"><span data-stu-id="20bcf-134">Customizations in a Derived Peer</span></span>  
 <span data-ttu-id="20bcf-135">Toutes les classes qui dérivent de <xref:System.Windows.UIElement> et <xref:System.Windows.ContentElement> contiennent la méthode virtuelle protégée <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-135">All classes that derive from <xref:System.Windows.UIElement> and <xref:System.Windows.ContentElement> contain the protected virtual method <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A>.</span></span> <span data-ttu-id="20bcf-136">WPF appelle <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> pour obtenir l’objet homologue automation pour chaque contrôle.</span><span class="sxs-lookup"><span data-stu-id="20bcf-136">WPF calls <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> to get the automation peer object for each control.</span></span> <span data-ttu-id="20bcf-137">Le code Automation peut utiliser l’homologue pour obtenir des informations sur les caractéristiques et les fonctionnalités d’un contrôle et pour simuler une utilisation interactive.</span><span class="sxs-lookup"><span data-stu-id="20bcf-137">Automation code can use the peer to get information about a control’s characteristics and features and to simulate interactive use.</span></span> <span data-ttu-id="20bcf-138">Un contrôle personnalisé qui prend en charge automation doit substituer <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> et retourner une instance d’une classe qui dérive de <xref:System.Windows.Automation.Peers.AutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-138">A custom control that supports automation must override <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> and return an instance of a class that derives from <xref:System.Windows.Automation.Peers.AutomationPeer>.</span></span> <span data-ttu-id="20bcf-139">Par exemple, si un contrôle personnalisé dérive la <xref:System.Windows.Controls.Primitives.ButtonBase> classe, puis l’objet retourné par <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> doit dériver de <xref:System.Windows.Automation.Peers.ButtonBaseAutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-139">For example, if a custom control derives from the <xref:System.Windows.Controls.Primitives.ButtonBase> class, then the object returned by <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> should derive from <xref:System.Windows.Automation.Peers.ButtonBaseAutomationPeer>.</span></span>  
  
 <span data-ttu-id="20bcf-140">Lorsque vous implémentez un contrôle personnalisé, vous devez substituer les méthodes « Core » à partir de la classe homologue Automation de base qui décrivent le comportement unique et spécifique à votre contrôle personnalisé.</span><span class="sxs-lookup"><span data-stu-id="20bcf-140">When implementing a custom control, you must override the "Core" methods from the base automation peer class that describe behavior unique and specific to your custom control.</span></span>  
  
### <a name="override-oncreateautomationpeer"></a><span data-ttu-id="20bcf-141">Substituer la méthode OnCreateAutomationPeer</span><span class="sxs-lookup"><span data-stu-id="20bcf-141">Override OnCreateAutomationPeer</span></span>  
 <span data-ttu-id="20bcf-142">Remplacer le <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> méthode pour votre contrôle personnalisé pour qu’elle retourne votre objet fournisseur, qui doit dériver directement ou indirectement <xref:System.Windows.Automation.Peers.AutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-142">Override the <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> method for your custom control so that it returns your provider object, which must derive directly or indirectly from <xref:System.Windows.Automation.Peers.AutomationPeer>.</span></span>  
  
### <a name="override-getpattern"></a><span data-ttu-id="20bcf-143">Substituer la méthode GetPattern</span><span class="sxs-lookup"><span data-stu-id="20bcf-143">Override GetPattern</span></span>  
 <span data-ttu-id="20bcf-144">Les homologues Automation simplifient certains aspects de l’implémentation des fournisseurs [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] côté serveur, fournisseurs, mais les homologues Automation d’un contrôle personnalisé doivent encore gérer les interfaces de modèle.</span><span class="sxs-lookup"><span data-stu-id="20bcf-144">Automation peers simplify some implementation aspects of server-side [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] providers, but custom control automation peers must still handle pattern interfaces.</span></span> <span data-ttu-id="20bcf-145">Comme les fournisseurs non WPF, homologues prennent en charge les modèles de contrôle en fournissant des implémentations d’interfaces dans les <xref:System.Windows.Automation.Provider?displayProperty=nameWithType> espace de noms, tel que <xref:System.Windows.Automation.Provider.IInvokeProvider>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-145">Like non-WPF providers, peers support control patterns by providing implementations of interfaces in the <xref:System.Windows.Automation.Provider?displayProperty=nameWithType> namespace, such as <xref:System.Windows.Automation.Provider.IInvokeProvider>.</span></span> <span data-ttu-id="20bcf-146">Les interfaces de modèle de contrôle peuvent être implémentées par l’homologue lui-même ou par un autre objet.</span><span class="sxs-lookup"><span data-stu-id="20bcf-146">The control pattern interfaces can be implemented by the peer itself or by another object.</span></span> <span data-ttu-id="20bcf-147">Implémentation de l’homologue de <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> retourne l’objet qui prend en charge le modèle spécifié.</span><span class="sxs-lookup"><span data-stu-id="20bcf-147">The peer's implementation of <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> returns the object that supports the specified pattern.</span></span> [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] <span data-ttu-id="20bcf-148">code appelle la <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> (méthode) et spécifie un <xref:System.Windows.Automation.Peers.PatternInterface> valeur d’énumération.</span><span class="sxs-lookup"><span data-stu-id="20bcf-148">code calls the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> method and specifies a <xref:System.Windows.Automation.Peers.PatternInterface> enumeration value.</span></span> <span data-ttu-id="20bcf-149">Votre substitution de <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> doit retourner l’objet qui implémente le modèle spécifié.</span><span class="sxs-lookup"><span data-stu-id="20bcf-149">Your override of <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> should return the object that implements the specified pattern.</span></span> <span data-ttu-id="20bcf-150">Si votre contrôle ne possède pas une implémentation personnalisée d’un modèle, vous pouvez appeler implémentation du type de base de <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> pour récupérer son implémentation ou null si le modèle n’est pas pris en charge pour ce type de contrôle.</span><span class="sxs-lookup"><span data-stu-id="20bcf-150">If your control does not have a custom implementation of a pattern, you can call the base type's implementation of <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> to retrieve either its implementation or null if the pattern is not supported for this control type.</span></span> <span data-ttu-id="20bcf-151">Par exemple, un contrôle NumericUpDown personnalisé peut être défini sur une valeur dans une plage, donc ses [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] homologue implémente le <xref:System.Windows.Automation.Provider.IRangeValueProvider> interface.</span><span class="sxs-lookup"><span data-stu-id="20bcf-151">For example, a custom NumericUpDown control can be set to a value within a range, so its [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] peer would implement the <xref:System.Windows.Automation.Provider.IRangeValueProvider> interface.</span></span> <span data-ttu-id="20bcf-152">L’exemple suivant montre comment l’homologue <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> méthode est substituée pour répondre à une <xref:System.Windows.Automation.Peers.PatternInterface.RangeValue?displayProperty=nameWithType> valeur.</span><span class="sxs-lookup"><span data-stu-id="20bcf-152">The following example shows how the peer's <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> method is overridden to respond to a <xref:System.Windows.Automation.Peers.PatternInterface.RangeValue?displayProperty=nameWithType> value.</span></span>  
  
 [!code-csharp[CustomControlNumericUpDown#GetPattern](~/samples/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp/CustomControlLibrary/NumericUpDown.cs#getpattern)]
 [!code-vb[CustomControlNumericUpDown#GetPattern](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic/customcontrollibrary/numericupdown.vb#getpattern)]  
  
 <span data-ttu-id="20bcf-153">Un <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> méthode peut également spécifier un sous-élément comme fournisseur de modèles.</span><span class="sxs-lookup"><span data-stu-id="20bcf-153">A <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> method can also specify a subelement as a pattern provider.</span></span> <span data-ttu-id="20bcf-154">Le code suivant montre comment <xref:System.Windows.Controls.ItemsControl> transfère la gestion de modèle à l’homologue de son texte interne du défilement <xref:System.Windows.Controls.ScrollViewer> contrôle.</span><span class="sxs-lookup"><span data-stu-id="20bcf-154">The following code shows how <xref:System.Windows.Controls.ItemsControl> transfers scroll pattern handling to the peer of its internal <xref:System.Windows.Controls.ScrollViewer> control.</span></span>  
  
```csharp  
public override object GetPattern(PatternInterface patternInterface)  
{  
    if (patternInterface == PatternInterface.Scroll)  
    {  
        ItemsControl owner = (ItemsControl) base.Owner;  
  
        // ScrollHost is internal to the ItemsControl class  
        if (owner.ScrollHost != null)  
        {  
            AutomationPeer peer = UIElementAutomationPeer.CreatePeerForElement(owner.ScrollHost);  
            if ((peer != null) && (peer is IScrollProvider))  
            {  
                peer.EventsSource = this;  
                return (IScrollProvider) peer;  
            }  
        }  
    }  
    return base.GetPattern(patternInterface);  
}  
```  
  
```vb  
Public Class Class1  
    Public Overrides Function GetPattern(ByVal patternInterface__1 As PatternInterface) As Object  
        If patternInterface1 = PatternInterface.Scroll Then  
            Dim owner As ItemsControl = DirectCast(MyBase.Owner, ItemsControl)  
  
            ' ScrollHost is internal to the ItemsControl class  
            If owner.ScrollHost IsNot Nothing Then  
                Dim peer As AutomationPeer = UIElementAutomationPeer.CreatePeerForElement(owner.ScrollHost)  
                If (peer IsNot Nothing) AndAlso (TypeOf peer Is IScrollProvider) Then  
                    peer.EventsSource = Me  
                    Return DirectCast(peer, IScrollProvider)  
                End If  
            End If  
        End If  
        Return MyBase.GetPattern(patternInterface1)  
    End Function  
End Class  
```  
  
 <span data-ttu-id="20bcf-155">Pour spécifier un sous-élément pour la gestion du modèle, ce code obtient l’objet de sous-élément, crée un homologue à l’aide de la <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.CreatePeerForElement%2A> (méthode), définit le <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A> propriété du nouvel homologue à l’homologue actuel et retourne le nouvel homologue.</span><span class="sxs-lookup"><span data-stu-id="20bcf-155">To specify a subelement for pattern handling, this code gets the subelement object, creates a peer by using the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.CreatePeerForElement%2A> method, sets the <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A> property of the new peer to the current peer, and returns the new peer.</span></span> <span data-ttu-id="20bcf-156">Paramètre <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A> sur un sous-élément empêche le sous-élément d’apparaître dans l’arborescence homologue automation et désigne tous les événements déclenchés par le sous-élément comme provenant du contrôle spécifié dans <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-156">Setting <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A> on a subelement prevents the subelement from appearing in the automation peer tree and designates all events raised by the subelement as originating from the control specified in <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A>.</span></span> <span data-ttu-id="20bcf-157">Le <xref:System.Windows.Controls.ScrollViewer> contrôle n’apparaît pas dans l’arborescence automation et les événements de défilement qu’il génère semblent provenir le <xref:System.Windows.Controls.ItemsControl> objet.</span><span class="sxs-lookup"><span data-stu-id="20bcf-157">The <xref:System.Windows.Controls.ScrollViewer> control does not appear in the automation tree, and scrolling events that it generates appear to originate from the <xref:System.Windows.Controls.ItemsControl> object.</span></span>  
  
### <a name="override-core-methods"></a><span data-ttu-id="20bcf-158">Substituer les méthodes « Core »</span><span class="sxs-lookup"><span data-stu-id="20bcf-158">Override "Core" Methods</span></span>  
 <span data-ttu-id="20bcf-159">Le code Automation obtient des informations sur votre contrôle en appelant des méthodes publiques de la classe homologue.</span><span class="sxs-lookup"><span data-stu-id="20bcf-159">Automation code gets information about your control by calling public methods of the peer class.</span></span> <span data-ttu-id="20bcf-160">Pour fournir des informations sur votre contrôle, substituez chaque méthode dont le nom se termine par « Core » lorsque l’implémentation de votre contrôle diffère de celle fournie par la classe homologue Automation de base.</span><span class="sxs-lookup"><span data-stu-id="20bcf-160">To provide information about your control, override each method whose name ends with "Core" when your control implementation differs from that of that provided by the base automation peer class.</span></span> <span data-ttu-id="20bcf-161">Au minimum, votre contrôle doit implémenter le <xref:System.Windows.Automation.Peers.AutomationPeer.GetClassNameCore%2A> et <xref:System.Windows.Automation.Peers.AutomationPeer.GetAutomationControlTypeCore%2A> méthodes, comme indiqué dans l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="20bcf-161">At a minimum, your control must implement the <xref:System.Windows.Automation.Peers.AutomationPeer.GetClassNameCore%2A> and <xref:System.Windows.Automation.Peers.AutomationPeer.GetAutomationControlTypeCore%2A> methods, as shown in the following example.</span></span>  
  
 [!code-csharp[CustomControlNumericUpDown#CoreOverrides](~/samples/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp/CustomControlLibrary/NumericUpDown.cs#coreoverrides)]
 [!code-vb[CustomControlNumericUpDown#CoreOverrides](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic/customcontrollibrary/numericupdown.vb#coreoverrides)]  
  
 <span data-ttu-id="20bcf-162">Votre implémentation de <xref:System.Windows.Automation.Peers.AutomationPeer.GetAutomationControlTypeCore%2A> décrit votre contrôle en retournant un <xref:System.Windows.Automation.ControlType> valeur.</span><span class="sxs-lookup"><span data-stu-id="20bcf-162">Your implementation of <xref:System.Windows.Automation.Peers.AutomationPeer.GetAutomationControlTypeCore%2A> describes your control by returning a <xref:System.Windows.Automation.ControlType> value.</span></span> <span data-ttu-id="20bcf-163">Bien que vous pouvez retourner <xref:System.Windows.Automation.ControlType.Custom?displayProperty=nameWithType>, vous devez retourner un des types de contrôle plus spécifiques s’il décrit votre contrôle correctement.</span><span class="sxs-lookup"><span data-stu-id="20bcf-163">Although you can return <xref:System.Windows.Automation.ControlType.Custom?displayProperty=nameWithType>, you should return one of the more specific control types if it accurately describes your control.</span></span> <span data-ttu-id="20bcf-164">La valeur de retour <xref:System.Windows.Automation.ControlType.Custom?displayProperty=nameWithType> nécessite un travail supplémentaire pour le fournisseur implémenter [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)], et [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] produits clients ne peuvent pas anticiper la structure de contrôle, interaction du clavier et les modèles de contrôle possibles.</span><span class="sxs-lookup"><span data-stu-id="20bcf-164">A return value of <xref:System.Windows.Automation.ControlType.Custom?displayProperty=nameWithType> requires extra work for the provider to implement [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)], and [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] client products are unable to anticipate the control structure, keyboard interaction, and possible control patterns.</span></span>  
  
 <span data-ttu-id="20bcf-165">Implémentez le <xref:System.Windows.Automation.Peers.AutomationPeer.IsContentElementCore%2A> et <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> méthodes pour indiquer si votre contrôle contient des données ou un rôle interactif dans l’interface utilisateur (ou les deux).</span><span class="sxs-lookup"><span data-stu-id="20bcf-165">Implement the <xref:System.Windows.Automation.Peers.AutomationPeer.IsContentElementCore%2A> and <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> methods to indicate whether your control contains data content or fulfills an interactive role in the user interface (or both).</span></span> <span data-ttu-id="20bcf-166">Par défaut, ces deux méthodes retournent `true`.</span><span class="sxs-lookup"><span data-stu-id="20bcf-166">By default, both methods return `true`.</span></span> <span data-ttu-id="20bcf-167">Ces paramètres facilitent l’utilisation des outils Automatisation, comme les lecteurs d’écran, qui peuvent utiliser ces méthodes pour filtrer l’arborescence Automation.</span><span class="sxs-lookup"><span data-stu-id="20bcf-167">These settings improve the usability of automation tools such as screen readers, which may use these methods to filter the automation tree.</span></span> <span data-ttu-id="20bcf-168">Si votre <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> méthode transferts gestion de modèle à un homologue de sous-élément, l’homologue de sous-élément <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> méthode peut retourner la valeur false pour masquer l’homologue de sous-élément dans l’arborescence automation.</span><span class="sxs-lookup"><span data-stu-id="20bcf-168">If your <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> method transfers pattern handling to a subelement peer, the subelement peer's <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> method can return false to hide the subelement peer from the automation tree.</span></span> <span data-ttu-id="20bcf-169">Par exemple, le défilement dans une <xref:System.Windows.Controls.ListBox> est gérée par un <xref:System.Windows.Controls.ScrollViewer>et l’homologue automation pour <xref:System.Windows.Automation.Peers.PatternInterface.Scroll?displayProperty=nameWithType> est retourné par la <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> méthode de la <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> qui est associé le <xref:System.Windows.Automation.Peers.ListBoxAutomationPeer>. Par conséquent, le <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> méthode de la <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> retourne `false`, de sorte que le <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> n’apparaît pas dans l’arborescence automation.</span><span class="sxs-lookup"><span data-stu-id="20bcf-169">For example, scrolling in a <xref:System.Windows.Controls.ListBox> is handled by a <xref:System.Windows.Controls.ScrollViewer>, and the automation peer for <xref:System.Windows.Automation.Peers.PatternInterface.Scroll?displayProperty=nameWithType> is returned by the <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> method of the <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> that is associated with the <xref:System.Windows.Automation.Peers.ListBoxAutomationPeer>.Therefore, the <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> method of the <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> returns `false`, so that the <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> does not appear in the automation tree.</span></span>  
  
 <span data-ttu-id="20bcf-170">Votre homologue Automation doit fournir des valeurs par défaut appropriées pour votre contrôle.</span><span class="sxs-lookup"><span data-stu-id="20bcf-170">Your automation peer should provide appropriate default values for your control.</span></span> <span data-ttu-id="20bcf-171">Notez que XAML qui référence votre contrôle peut substituer vos implémentations homologues de méthodes core en incluant <xref:System.Windows.Automation.AutomationProperties> attributs.</span><span class="sxs-lookup"><span data-stu-id="20bcf-171">Note that XAML that references your control can override your peer implementations of core methods by including <xref:System.Windows.Automation.AutomationProperties> attributes.</span></span> <span data-ttu-id="20bcf-172">Par exemple, le code XAML suivant crée un bouton qui comporte deux propriétés [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] personnalisées.</span><span class="sxs-lookup"><span data-stu-id="20bcf-172">For example, the following XAML creates a button that has two customized [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] properties.</span></span>  
  
```xaml  
<Button AutomationProperties.Name="Special"   
    AutomationProperties.HelpText="This is a special button."/>  
```  
  
### <a name="implement-pattern-providers"></a><span data-ttu-id="20bcf-173">Implémenter des fournisseurs de modèles</span><span class="sxs-lookup"><span data-stu-id="20bcf-173">Implement Pattern Providers</span></span>  
 <span data-ttu-id="20bcf-174">Les interfaces implémentées par un fournisseur personnalisé sont déclarées explicitement si l’élément propriétaire dérive directement de <xref:System.Windows.Controls.Control>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-174">The interfaces implemented by a custom provider are explicitly declared if the owning element derives directly from <xref:System.Windows.Controls.Control>.</span></span> <span data-ttu-id="20bcf-175">Par exemple, le code suivant déclare un homologue pour un <xref:System.Windows.Controls.Control> qui implémente une valeur de plage.</span><span class="sxs-lookup"><span data-stu-id="20bcf-175">For example, the following code declares a peer for a <xref:System.Windows.Controls.Control> that implements a range value.</span></span>  
  
```csharp  
public class RangePeer1 : FrameworkElementAutomationPeer, IRangeValueProvider { }  
```  
  
```vb  
Public Class RangePeer1  
    Inherits FrameworkElementAutomationPeer  
    Implements IRangeValueProvider  
End Class  
```  
  
 <span data-ttu-id="20bcf-176">Si le contrôle propriétaire dérive d’un type spécifique de contrôle tel que <xref:System.Windows.Controls.Primitives.RangeBase>, l’homologue peut être dérivé d’une classe homologue dérivée équivalente.</span><span class="sxs-lookup"><span data-stu-id="20bcf-176">If the owning control derives from a specific type of control such as <xref:System.Windows.Controls.Primitives.RangeBase>, the peer can be derived from an equivalent derived peer class.</span></span> <span data-ttu-id="20bcf-177">Dans ce cas, l’homologue dériverait de <xref:System.Windows.Automation.Peers.RangeBaseAutomationPeer>, qui fournit une implémentation de base de <xref:System.Windows.Automation.Provider.IRangeValueProvider>.</span><span class="sxs-lookup"><span data-stu-id="20bcf-177">In this case, the peer would derive from <xref:System.Windows.Automation.Peers.RangeBaseAutomationPeer>, which supplies a base implementation of <xref:System.Windows.Automation.Provider.IRangeValueProvider>.</span></span> <span data-ttu-id="20bcf-178">Le code suivant illustre la déclaration de ce type d’homologue.</span><span class="sxs-lookup"><span data-stu-id="20bcf-178">The following code shows the declaration of such a peer.</span></span>  
  
```csharp  
public class RangePeer2 : RangeBaseAutomationPeer { }  
```  
  
```vb  
Public Class RangePeer2  
    Inherits RangeBaseAutomationPeer  
End Class  
```  
  
 <span data-ttu-id="20bcf-179">Pour un exemple d’implémentation, consultez [Contrôle personnalisé NumericUpDown avec thème et prise en charge d'UI Automation, exemple](https://go.microsoft.com/fwlink/?LinkID=160025).</span><span class="sxs-lookup"><span data-stu-id="20bcf-179">For an example implementation, see [NumericUpDown Custom Control with Theme and UI Automation Support Sample](https://go.microsoft.com/fwlink/?LinkID=160025).</span></span>  
  
### <a name="raise-events"></a><span data-ttu-id="20bcf-180">Déclencher des événements</span><span class="sxs-lookup"><span data-stu-id="20bcf-180">Raise Events</span></span>  
 <span data-ttu-id="20bcf-181">Les clients Automation peuvent s’abonner à des événements Automation.</span><span class="sxs-lookup"><span data-stu-id="20bcf-181">Automation clients can subscribe to automation events.</span></span> <span data-ttu-id="20bcf-182">Contrôles personnalisés doivent signaler les modifications apportées à l’état du contrôle en appelant le <xref:System.Windows.Automation.Peers.AutomationPeer.RaiseAutomationEvent%2A> (méthode).</span><span class="sxs-lookup"><span data-stu-id="20bcf-182">Custom controls must report changes to control state by calling the <xref:System.Windows.Automation.Peers.AutomationPeer.RaiseAutomationEvent%2A> method.</span></span> <span data-ttu-id="20bcf-183">De même, lorsqu’une valeur de propriété change, appelez le <xref:System.Windows.Automation.Peers.AutomationPeer.RaisePropertyChangedEvent%2A> (méthode).</span><span class="sxs-lookup"><span data-stu-id="20bcf-183">Similarly, when a property value changes, call the <xref:System.Windows.Automation.Peers.AutomationPeer.RaisePropertyChangedEvent%2A> method.</span></span> <span data-ttu-id="20bcf-184">Le code suivant montre comment obtenir l’objet homologue à partir du code de contrôle et appeler une méthode pour déclencher un événement.</span><span class="sxs-lookup"><span data-stu-id="20bcf-184">The following code shows how to get the peer object from within the control code and call a method to raise an event.</span></span> <span data-ttu-id="20bcf-185">À des fins d’optimisation, le code détermine s’il existe des écouteurs pour ce type d’événement.</span><span class="sxs-lookup"><span data-stu-id="20bcf-185">As an optimization, the code determines if there are any listeners for this event type.</span></span> <span data-ttu-id="20bcf-186">Déclencher l’événement uniquement lorsqu’il y a des écouteurs évite les surcharges inutiles et permet au contrôle de rester réactif.</span><span class="sxs-lookup"><span data-stu-id="20bcf-186">Raising the event only when there are listeners avoids unnecessary overhead and helps the control remain responsive.</span></span>  
  
 [!code-csharp[CustomControlNumericUpDown#RaiseEventFromControl](~/samples/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp/CustomControlLibrary/NumericUpDown.cs#raiseeventfromcontrol)]
 [!code-vb[CustomControlNumericUpDown#RaiseEventFromControl](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic/customcontrollibrary/numericupdown.vb#raiseeventfromcontrol)]  
  
## <a name="see-also"></a><span data-ttu-id="20bcf-187">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="20bcf-187">See also</span></span>

- [<span data-ttu-id="20bcf-188">Vue d’ensemble d’UI Automation</span><span class="sxs-lookup"><span data-stu-id="20bcf-188">UI Automation Overview</span></span>](../../ui-automation/ui-automation-overview.md)
- [<span data-ttu-id="20bcf-189">Contrôle personnalisé NumericUpDown avec thème et prise en charge d’UI Automation, exemple</span><span class="sxs-lookup"><span data-stu-id="20bcf-189">NumericUpDown Custom Control with Theme and UI Automation Support Sample</span></span>](https://go.microsoft.com/fwlink/?LinkID=160025)
- [<span data-ttu-id="20bcf-190">Implémentation de fournisseur UI Automation côté serveur</span><span class="sxs-lookup"><span data-stu-id="20bcf-190">Server-Side UI Automation Provider Implementation</span></span>](../../ui-automation/server-side-ui-automation-provider-implementation.md)
